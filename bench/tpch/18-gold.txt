atuple([aorderedidx(dedup(groupby([sum(l_quantity) as tot_quantity],
                                  [l_orderkey],
                                  lineitem)),
          alist(dedup(filter((tot_quantity = tot_quantity_v),
                  groupby([l_orderkey, sum(l_quantity) as tot_quantity_v],
                          [l_orderkey],
                          lineitem))),
            ascalar(l_orderkey)),
          param1 + 0.00001,
          9999999),
        ahashidx(select([o_orderkey as key], orders),
          alist(groupby([c_name,
                         c_custkey,
                         o_orderkey,
                         o_orderdate,
                         o_totalprice,
                         sum(l_quantity) as q],
                  [c_name, c_custkey, o_orderkey, o_orderdate, o_totalprice],
                  join((c_custkey = o_custkey),
                    join((o_orderkey = l_orderkey),
                      filter((o_orderkey = key), orders),
                      lineitem),
                    customer)),
            atuple([ascalar(c_name),
                    ascalar(c_custkey),
                    ascalar(o_orderkey),
                    ascalar(o_orderdate),
                    ascalar(o_totalprice)],
              cross)),
          l_orderkey)],
  cross)
