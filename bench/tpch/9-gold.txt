alist(orderby([k0_nation, k0_o_year],
        join(true,
          dedup(select([n_name as k0_nation], nation)),
          dedup(select([to_year(o_orderdate) as k0_o_year], orders))),
        asc),
  select([nation, o_year, sum(amount) as sum_profit],
    filter((strpos(part.p_name, param1) > 0),
      alist(filter(((nation = k0_nation) && (o_year = k0_o_year)),
              select([nation.n_name as nation,
                      to_year(orders.o_orderdate) as o_year,
                      ((lineitem.l_extendedprice * (1 - lineitem.l_discount))
                      - (partsupp.ps_supplycost * lineitem.l_quantity)) as amount,
                      part.p_name],
                join((supplier.s_suppkey = lineitem.l_suppkey),
                  join(((partsupp.ps_suppkey = lineitem.l_suppkey) &&
                       (partsupp.ps_partkey = lineitem.l_partkey)),
                    join((part.p_partkey = lineitem.l_partkey),
                      part,
                      join((orders.o_orderkey = lineitem.l_orderkey),
                        orders,
                        lineitem)),
                    partsupp),
                  join((supplier.s_nationkey = nation.n_nationkey),
                    supplier,
                    nation)))),
        atuple([ascalar(nation),
                ascalar(o_year),
                ascalar(amount),
                ascalar(part.p_name)],
          cross)))))
